apply plugin: 'com.android.application'
apply plugin: 'me.tatarka.retrolambda'
apply plugin: 'org.greenrobot.greendao'//GreenDao
apply plugin: 'kotlin-android'



android {
    signingConfigs {
        config {
            keyAlias 'towards'
            keyPassword 'towards123'
            storeFile file('towards_store.jks')
            storePassword 'towards123'
        }
    }
    compileSdkVersion rootProject.ext.android.compileSdkVersion
    buildToolsVersion rootProject.ext.android.buildToolsVersion
    publishNonDefault true
    defaultPublishConfig "debug"
    defaultConfig {
        applicationId "com.waitou.towards"
        minSdkVersion rootProject.ext.android.minSdkVersion
        targetSdkVersion rootProject.ext.android.targetSdkVersion
        versionCode 2
        versionName "2.0.0"
        resConfigs "zh"
        //支持dataBinding
        dataBinding {
            enabled = true
        }
        multiDexEnabled true

        ndk { abiFilters "armeabi", "armeabi-v7a", "x86", "mips" }
    }

    buildTypes {
        release {
            //混淆
            minifyEnabled true
            //ZipAlign优化
            zipAlignEnabled true
            //去除无用资源
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            manifestPlaceholders = [packageName1: "com.waitou.towards",
                                    appName     : "大杂烩"]
            signingConfig signingConfigs.config
        }
        debug {
            applicationIdSuffix '.debug'
            versionNameSuffix '-DEBUG'
            minifyEnabled false
            manifestPlaceholders = [packageName1: "com.waitou.towards.debug",
                                    appName     : "大杂烩测试"]
            signingConfig signingConfigs.config
            applicationVariants.all { variant ->
                variant.outputs.each { output ->
                    def apkFile = new File(
                            output.outputFile.getParent(),
                            "towards_v${variant.versionName}_${variant.buildType.name}.apk")
                    output.outputFile = apkFile
                    //删除unaligned
                    if (output.zipAlign != null) {
                        output.zipAlign.doLast {
                            output.zipAlign.inputFile.delete()
                        }
                    }
                }
            }

        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    greendao {
        schemaVersion 1//数据库版本号
        daoPackage 'com.waitou.towards.greendao'
        targetGenDir 'src/main/java'
    }

}
//dataBinding kotlin
kapt {
    generateStubs = true
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    compile rootProject.ext.dependencies['gradle-retrolambda']
    compile rootProject.ext.dependencies['cardview-v7']
    compile rootProject.ext.dependencies["smarttablayout"]
    compile rootProject.ext.dependencies["circleimageview"]
    compile rootProject.ext.dependencies["flexbox"]
    compile rootProject.ext.dependencies["fab"]
    compile rootProject.ext.dependencies["stetho"]
    compile rootProject.ext.dependencies["rxcache"]
    compile rootProject.ext.dependencies["jolyglot_gson"]
    compile rootProject.ext.dependencies["greendao"]
    compile rootProject.ext.dependencies["bubbleseekbar"]
    compile rootProject.ext.dependencies["vlayout"]
    compile rootProject.ext.dependencies["kotlin"]
    kapt rootProject.ext.dependencies["databinding_kapt"]

    //工程依赖 app --> wt_library --> net_library
    debugCompile project(path: ':photo_library', configuration: 'debug')
    releaseCompile project(path: ':photo_library', configuration: 'release')
    debugCompile project(path: ':three_library', configuration: 'debug')
    releaseCompile project(path: ':three_library', configuration: 'release')
}

